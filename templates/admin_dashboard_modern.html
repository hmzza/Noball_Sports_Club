<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - The Noball Sports Club</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-components.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.min.css">
</head>
<body class="modern-body">
    <!-- Admin Navigation Header -->
    {% set page_title = "Admin Dashboard" %}
    {% set icon_class = "fas fa-tachometer-alt" %}
    {% set page_subtitle = "Modern dashboard view with advanced analytics" %}
    {% include 'admin_navbar.html' %}
    
    <!-- Header -->
    <header class="modern-header">
        <div class="modern-container">
            <div class="modern-header-content">
                <h1 class="modern-header-title">
                    <i class="fas fa-tachometer-alt"></i>
                    Admin Dashboard
                </h1>
                <div class="modern-header-actions">
                    <div class="modern-header-time" id="current-time">
                        <i class="fas fa-clock"></i>
                        <span id="time-display">Loading...</span>
                    </div>
                    <button class="modern-btn modern-btn-ghost" id="refresh-dashboard">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                    <a href="{{ url_for('index') }}" class="modern-btn modern-btn-ghost">
                        <i class="fas fa-home"></i> Website
                    </a>
                    <button class="modern-btn modern-btn-outline-danger" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="modern-container">
        <!-- Stats Dashboard -->
        <div class="modern-dashboard-grid">
            <!-- Total Bookings -->
            <div class="modern-card modern-card-stats">
                <div class="modern-card-header">
                    <div class="modern-card-icon modern-bg-primary">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="modern-card-title">
                        <h3>Total Bookings</h3>
                        <p>All time bookings</p>
                    </div>
                </div>
                <div class="modern-card-content">
                    <div class="modern-stat-number" id="total-bookings">{{ stats.total_bookings or 0 }}</div>
                    <div class="modern-stat-change modern-stat-positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="bookings-growth">+{{ stats.growth_bookings or 0 }}%</span>
                        <span class="modern-stat-period">vs last month</span>
                    </div>
                </div>
            </div>

            <!-- Pending Payments -->
            <div class="modern-card modern-card-stats">
                <div class="modern-card-header">
                    <div class="modern-card-icon modern-bg-warning">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="modern-card-title">
                        <h3>Pending Payment</h3>
                        <p>Requires attention</p>
                    </div>
                </div>
                <div class="modern-card-content">
                    <div class="modern-stat-number" id="pending-payment">{{ stats.pending_payment or 0 }}</div>
                    <div class="modern-stat-actions">
                        <button class="modern-btn modern-btn-sm modern-btn-warning" onclick="viewPendingBookings()">
                            <i class="fas fa-eye"></i> View All
                        </button>
                    </div>
                </div>
            </div>

            <!-- Confirmed Bookings -->
            <div class="modern-card modern-card-stats">
                <div class="modern-card-header">
                    <div class="modern-card-icon modern-bg-success">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="modern-card-title">
                        <h3>Confirmed</h3>
                        <p>Active bookings</p>
                    </div>
                </div>
                <div class="modern-card-content">
                    <div class="modern-stat-number" id="confirmed-bookings">{{ stats.confirmed or 0 }}</div>
                    <div class="modern-stat-change modern-stat-positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="confirmed-growth">+{{ stats.growth_confirmed or 0 }}%</span>
                        <span class="modern-stat-period">this week</span>
                    </div>
                </div>
            </div>

            <!-- Revenue -->
            <div class="modern-card modern-card-stats">
                <div class="modern-card-header">
                    <div class="modern-card-icon modern-bg-info">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                    <div class="modern-card-title">
                        <h3>Total Revenue</h3>
                        <p>All time earnings</p>
                    </div>
                </div>
                <div class="modern-card-content">
                    <div class="modern-stat-number" id="total-revenue">PKR {{ "{:,}".format(stats.revenue or 0) }}</div>
                    <div class="modern-stat-change modern-stat-positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="revenue-growth">+{{ stats.growth_revenue or 0 }}%</span>
                        <span class="modern-stat-period">vs last quarter</span>
                    </div>
                </div>
            </div>

            <!-- Today's Stats -->
            <div class="modern-card modern-card-wide">
                <div class="modern-card-header">
                    <h3 class="modern-card-title">
                        <i class="fas fa-calendar-day"></i>
                        Today's Overview
                    </h3>
                    <span class="modern-card-date" id="today-date">{{ today_date or 'N/A' }}</span>
                </div>
                <div class="modern-card-content">
                    <div class="modern-today-stats">
                        <div class="modern-today-stat-item">
                            <div class="modern-today-stat-icon modern-bg-primary">
                                <i class="fas fa-calendar-plus"></i>
                            </div>
                            <div class="modern-today-stat-content">
                                <div class="modern-today-stat-number" id="today-bookings">{{ stats.today_bookings or 0 }}</div>
                                <div class="modern-today-stat-label">New Bookings</div>
                            </div>
                        </div>

                        <div class="modern-today-stat-item">
                            <div class="modern-today-stat-icon modern-bg-success">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="modern-today-stat-content">
                                <div class="modern-today-stat-number" id="today-revenue">PKR {{ "{:,}".format(stats.today_revenue or 0) }}</div>
                                <div class="modern-today-stat-label">Revenue</div>
                            </div>
                        </div>

                        <div class="modern-today-stat-item">
                            <div class="modern-today-stat-icon modern-bg-warning">
                                <i class="fas fa-hourglass-half"></i>
                            </div>
                            <div class="modern-today-stat-content">
                                <div class="modern-today-stat-number" id="today-hours">{{ stats.today_hours or 0 }}h</div>
                                <div class="modern-today-stat-label">Hours Booked</div>
                            </div>
                        </div>

                        <div class="modern-today-stat-item">
                            <div class="modern-today-stat-icon modern-bg-info">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="modern-today-stat-content">
                                <div class="modern-today-stat-number" id="today-utilization">{{ stats.today_utilization or 0 }}%</div>
                                <div class="modern-today-stat-label">Court Utilization</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chart Card -->
            <div class="modern-card modern-card-wide">
                <div class="modern-card-header">
                    <h3 class="modern-card-title">
                        <i class="fas fa-chart-line"></i>
                        Booking Trends
                    </h3>
                    <div class="modern-card-actions">
                        <button class="modern-btn modern-btn-sm modern-btn-ghost" id="chart-period-btn">
                            Last 7 Days <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
                <div class="modern-card-content">
                    <canvas id="bookings-chart" height="100"></canvas>
                </div>
            </div>
        </div>

        <!-- Management Section -->
        <div class="modern-section-title">
            <h2>Management Tools</h2>
            <p>Quick access to admin functions</p>
        </div>

        <div class="modern-management-grid">
            <!-- Booking Management -->
            <div class="modern-card modern-card-action" onclick="navigateTo('{{ url_for('admin_panel.admin_bookings') }}')">
                <div class="modern-card-header">
                    <div class="modern-card-icon modern-bg-primary">
                        <i class="fas fa-list-alt"></i>
                    </div>
                    <div class="modern-card-title">
                        <h3>Booking Management</h3>
                        <p>View, confirm, or manage booking requests</p>
                    </div>
                </div>
                <div class="modern-card-stats">
                    <span class="modern-stat-number">{{ stats.pending_payment or 0 }}</span>
                    <span class="modern-stat-label">pending</span>
                </div>
                <div class="modern-card-arrow">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>

            <!-- Schedule View -->
            <div class="modern-card modern-card-action" onclick="navigateTo('{{ url_for('admin_panel.admin_schedule') }}')">
                <div class="modern-card-header">
                    <div class="modern-card-icon modern-bg-success">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="modern-card-title">
                        <h3>Schedule View</h3>
                        <p>Visual timeline and slot management</p>
                    </div>
                </div>
                <div class="modern-card-stats">
                    <span class="modern-stat-number">{{ stats.today_bookings or 0 }}</span>
                    <span class="modern-stat-label">today</span>
                </div>
                <div class="modern-card-arrow">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>

            <!-- Booking Control -->
            <div class="modern-card modern-card-action" onclick="navigateTo('{{ url_for('admin_panel.admin_booking_control') }}')">
                <div class="modern-card-header">
                    <div class="modern-card-icon modern-bg-warning">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div class="modern-card-title">
                        <h3>Booking Control</h3>
                        <p>Create, edit, and bulk operations</p>
                    </div>
                </div>
                <div class="modern-card-stats">
                    <span class="modern-stat-text">Advanced</span>
                    <span class="modern-stat-label">tools</span>
                </div>
                <div class="modern-card-arrow">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>

            <!-- Reports -->
            <a href="{{ url_for('admin_panel.reports') }}" class="modern-card modern-card-action" style="text-decoration: none; color: inherit;">
                <div class="modern-card-header">
                    <div class="modern-card-icon modern-bg-info">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="modern-card-title">
                        <h3>Reports & Analytics</h3>
                        <p>Detailed insights and export options</p>
                    </div>
                </div>
                <div class="modern-card-stats">
                    <span class="modern-stat-text">Available</span>
                    <span class="modern-stat-label">now</span>
                </div>
                <div class="modern-card-arrow">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="modern-section-title">
            <h2>Quick Actions</h2>
            <p>Common tasks and shortcuts</p>
        </div>

        <div class="modern-quick-actions">
            <button class="modern-btn modern-btn-primary modern-btn-lg" onclick="quickCreateBooking()">
                <i class="fas fa-plus-circle"></i>
                Quick Booking
            </button>
            <button class="modern-btn modern-btn-success modern-btn-lg" onclick="viewTodaySchedule()">
                <i class="fas fa-calendar-day"></i>
                Today's Schedule
            </button>
            <button class="modern-btn modern-btn-info modern-btn-lg" onclick="exportData()">
                <i class="fas fa-download"></i>
                Export Data
            </button>
            <button class="modern-btn modern-btn-warning modern-btn-lg" onclick="sendNotifications()">
                <i class="fas fa-bell"></i>
                Notifications
            </button>
        </div>

        <!-- Recent Activity -->
        {% if bookings %}
        <div class="modern-card">
            <div class="modern-card-header">
                <h3 class="modern-card-title">
                    <i class="fas fa-history"></i>
                    Recent Activity
                </h3>
                <a href="{{ url_for('admin_panel.admin_bookings') }}" class="modern-btn modern-btn-sm modern-btn-ghost">
                    View All <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <div class="modern-card-content">
                <div class="modern-activity-list">
                    {% for booking in bookings[:5] %}
                    <div class="modern-activity-item">
                        <div class="modern-activity-icon modern-status-{{ booking.status.replace('_', '-') }}">
                            {% if booking.status == 'pending_payment' %}
                                <i class="fas fa-clock"></i>
                            {% elif booking.status == 'confirmed' %}
                                <i class="fas fa-check"></i>
                            {% elif booking.status == 'cancelled' %}
                                <i class="fas fa-times"></i>
                            {% endif %}
                        </div>
                        <div class="modern-activity-content">
                            <div class="modern-activity-title">
                                {{ booking.player_name }} - {{ booking.sport.title() }}
                            </div>
                            <div class="modern-activity-details">
                                {{ booking.court_name }} • {{ booking.formatted_time|safe }} • PKR {{ "{:,}".format(booking.total_amount or 0) }}
                            </div>
                            <div class="modern-activity-time">{{ booking.createdDateTime or 'Just now' }}</div>
                        </div>
                        <div class="modern-activity-status">
                            <span class="modern-status-badge modern-status-{{ booking.status.replace('_', '-') }}">
                                {% if booking.status == 'pending_payment' %}
                                    Pending
                                {% elif booking.status == 'confirmed' %}
                                    Confirmed
                                {% elif booking.status == 'cancelled' %}
                                    Cancelled
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- System Status -->
        <div class="modern-card">
            <div class="modern-card-header">
                <h3 class="modern-card-title">
                    <i class="fas fa-server"></i>
                    System Status
                </h3>
                <div class="modern-status-overall modern-status-online">
                    <i class="fas fa-check-circle"></i>
                    All Systems Operational
                </div>
            </div>
            <div class="modern-card-content">
                <div class="modern-system-status-grid">
                    <div class="modern-status-item">
                        <div class="modern-status-indicator modern-status-online"></div>
                        <div class="modern-status-content">
                            <div class="modern-status-title">Database</div>
                            <div class="modern-status-subtitle">Connected & Healthy</div>
                        </div>
                        <div class="modern-status-metric">99.9%</div>
                    </div>
                    <div class="modern-status-item">
                        <div class="modern-status-indicator modern-status-online"></div>
                        <div class="modern-status-content">
                            <div class="modern-status-title">Booking Engine</div>
                            <div class="modern-status-subtitle">Running Smoothly</div>
                        </div>
                        <div class="modern-status-metric">100%</div>
                    </div>
                    <div class="modern-status-item">
                        <div class="modern-status-indicator modern-status-online"></div>
                        <div class="modern-status-content">
                            <div class="modern-status-title">Payment Gateway</div>
                            <div class="modern-status-subtitle">Active & Secure</div>
                        </div>
                        <div class="modern-status-metric">98.5%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Info -->
        <div class="modern-dashboard-footer">
            <div class="modern-footer-info">
                <span>Last updated: <span id="last-update-time">Loading...</span></span>
                <span>•</span>
                <span>Auto-refresh: <span class="modern-status-online">Enabled</span></span>
                <span>•</span>
                <span>Version: 2.0.0</span>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/core/__init__.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin_dashboard_modern.js') }}"></script>

    <script>
        // Global functions for onclick handlers
        function navigateTo(url) {
            window.location.href = url;
        }

        function quickCreateBooking() {
            window.location.href = "{{ url_for('admin_panel.admin_booking_control') }}";
        }

        function viewTodaySchedule() {
            const today = new Date().toISOString().split('T')[0];
            window.location.href = `{{ url_for('admin_panel.admin_schedule') }}?date=${today}`;
        }

        function viewPendingBookings() {
            window.location.href = "{{ url_for('admin_panel.admin_bookings') }}?status=pending_payment";
        }

        function exportData() {
            toast.info('Export feature will be available soon!');
        }

        function sendNotifications() {
            toast.info('Bulk notification feature coming soon!');
        }

        // Reports now links directly to reports page

        // Logout handler
        document.getElementById('logout-btn').addEventListener('click', function() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '{{ url_for("admin_panel.admin_logout") }}';
            }
        });
    </script>
</body>
</html>